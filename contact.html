<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Client Contact ‚Äì BrandZone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #191919; /* Notion dark mode h√°tt√©r */
      color: #f5f5f5;
      margin: 0;
      padding: 40px;
    }

    .wrapper {
      max-width: 780px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 22px;
    }

    h2 {
      margin: 0;
      font-size: 32px;
      font-weight: 700;
      color: #f1f1f1;
    }

    .tagline {
      font-size: 15px;
      color: #b5b5b5;
      margin-top: -10px;
      margin-bottom: 18px;
    }

    /* Project bar */
    .project-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px 16px;
      border-radius: 12px;
      background: #232323;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .project-bar label {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #bdbdbd;
    }

    .project-bar input[type="text"] {
      flex: 1;
      min-width: 160px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #3c3c3c;
      background: #1f1f1f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .project-bar button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      background: #3b82f6;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .project-bar button.secondary {
      background: #404040;
    }

    .status-text {
      font-size: 12px;
      color: #a5a5a5;
      margin-top: 4px;
    }

    /* Accordion ‚Äì Notion st√≠lus */
    .accordion {
      border-radius: 16px;
      background: #2B2B2B;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.06);
      transition: 0.15s ease;
    }

    .accordion:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
    }

    .accordion-header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 22px;
      background: #2F2F2F;
      border: none;
      cursor: pointer;
      color: #fafafa;
      font-size: 16px;
      font-weight: 600;
    }

    .accordion-header span.icon {
      font-size: 18px;
      transition: transform 0.2s ease;
    }

    .accordion.open .accordion-header span.icon {
      transform: rotate(90deg);
    }

    .accordion-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.25s ease;
      background: #242424;
      padding: 0 22px;
    }

    .accordion.open .accordion-body {
      padding: 14px 22px 20px 22px;
      max-height: 900px;
    }

    .accordion-body label {
      display: block;
      font-size: 12px;
      letter-spacing: 0.05em;
      margin-top: 12px;
      margin-bottom: 6px;
      color: #bdbdbd;
      text-transform: uppercase;
    }

    .accordion-body input,
    .accordion-body textarea {
      width: 100%;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #3c3c3c;
      background: #1f1f1f;
      color: #f5f5f5;
      font-size: 15px;
      outline: none;
      margin-bottom: 6px;
    }

    .accordion-body textarea {
      resize: vertical;
      min-height: 60px;
    }

    /* Checkbox ‚Äì Notion style */
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      margin-bottom: 6px;
      margin-top: 4px;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: #e5e5e5;
      cursor: pointer;
    }

    .checkbox-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      border: 1px solid #666;
      background: #1f1f1f;
      appearance: none;
      position: relative;
    }

    .checkbox-group input[type="checkbox"]:checked::before {
      content: "";
      position: absolute;
      inset: 2px;
      background: #3b82f6;
      border-radius: 2px;
    }

    .small-note {
      font-size: 12px;
      color: #a5a5a5;
      margin-bottom: 4px;
    }

    @media (max-width: 600px) {
      body {
        padding: 20px;
      }
      .accordion-header {
        padding: 14px 16px;
      }
      .accordion.open .accordion-body {
        padding: 12px 16px 16px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h2>Client contact ‚Äì BrandZone</h2>
    <p class="tagline">Click the grey boxes to reveal the fields to fill out.</p>

    <!-- PROJECT BAR -->
    <div class="project-bar">
      <label for="projectCode">Project code</label>
      <input id="projectCode" type="text" placeholder="Pl. MINIHOME_2025_Q1" />
      <button id="loadProjectBtn" class="secondary">Load</button>
      <button id="saveProjectBtn">Save</button>
      <div class="status-text" id="statusText"></div>
    </div>

    <!-- CONTACT PERSON -->
    <div class="accordion">
      <button class="accordion-header">
        üßë Contact person <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Name</label>
        <input type="text" placeholder="Contact person name" data-field="contact_person_name">

        <label>Form of address</label>
        <input type="text" placeholder="casual / polite" data-field="form_of_address">
      </div>
    </div>

    <!-- CONTACT DETAILS -->
    <div class="accordion">
      <button class="accordion-header">
        üìû Contact details <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Phone number</label>
        <input type="text" placeholder="+40 ..." data-field="phone_number">

        <label>E-mail</label>
        <input type="email" placeholder="name@company.com" data-field="email">
      </div>
    </div>

    <!-- WEBSITE & SOCIALS -->
    <div class="accordion">
      <button class="accordion-header">
        üåê Website & Socials <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Website</label>
        <input type="url" placeholder="https://..." data-field="website">

        <label>TikTok</label>
        <input type="url" placeholder="https://www.tiktok.com/@..." data-field="tiktok">

        <label>Facebook</label>
        <input type="url" placeholder="Facebook page link" data-field="facebook">

        <label>Instagram</label>
        <input type="url" placeholder="@brand" data-field="instagram">

        <label>YouTube</label>
        <input type="url" placeholder="Channel link" data-field="youtube">
      </div>
    </div>

    <!-- NEEDS HELP WITH -->
    <div class="accordion">
      <button class="accordion-header">
        üéØ Needs help with <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Problems / pain points</label>
        <textarea placeholder="- Short-form videos, strategy‚Ä¶" data-field="needs_help"></textarea>
      </div>
    </div>

    <!-- PRIMARY COMMUNICATION -->
    <div class="accordion">
      <button class="accordion-header">
        üì¨ Primary communication <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Primary communication</label>
        <div class="checkbox-group">
          <label><input type="checkbox" data-field="primary_email">Email</label>
          <label><input type="checkbox" data-field="primary_whatsapp">WhatsApp</label>
        </div>
      </div>
    </div>

    <!-- POTENTIAL COLLAB -->
    <div class="accordion">
      <button class="accordion-header">
        üìä Potential collab <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Potential collab</label>
        <p class="small-note">How much potential do you see in the collaboration?</p>
        <div class="checkbox-group">
          <label><input type="checkbox" data-field="potential_high">High</label>
          <label><input type="checkbox" data-field="potential_medium">Medium</label>
          <label><input type="checkbox" data-field="potential_low">Low</label>
        </div>
      </div>
    </div>

    <!-- NOTES -->
    <div class="accordion">
      <button class="accordion-header">
        üìù Notes <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Notes</label>
        <textarea placeholder="Any extra info, meeting notes, vibe, important details..." data-field="notes"></textarea>
      </div>
    </div>

    <!-- OVERVIEW: INDUSTRY -->
    <div class="accordion">
      <button class="accordion-header">
        üí° Industry (Services, Products, Prices) <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Industry</label>
        <textarea placeholder="- Services
- Products
- Price range" data-field="industry"></textarea>
      </div>
    </div>

    <!-- OVERVIEW: EMPLOYEES -->
    <div class="accordion">
      <button class="accordion-header">
        üí° Employees <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Employees</label>
        <textarea placeholder="- Number of employees
- Key roles / departments" data-field="employees"></textarea>
      </div>
    </div>

    <!-- OVERVIEW: WHAT ARE THEY INTERESTED IN -->
    <div class="accordion">
      <button class="accordion-header">
        üí° What are they interested in <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>What are they interested in</label>
        <p class="small-note">Write down the simple need of the lead ‚Äì mit szeretn√©nek el√©rni a social / vide√≥kkal.</p>
        <textarea placeholder="Pl.: more online leads, brand building, employer branding, TikTok presence, etc." data-field="interest"></textarea>
      </div>
    </div>

  </div>

  <!-- Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // --- Supabase config ---
    const supabaseUrl = "https://hxtfxjectgauodnzxuqy.supabase.co";
    const supabaseKey = "sb_publishable_Tmc24ujjcIIm3RJ2PKXysA_EI6qPXau";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    const statusEl = document.getElementById("statusText");
    const projectInput = document.getElementById("projectCode");
    const loadBtn = document.getElementById("loadProjectBtn");
    const saveBtn = document.getElementById("saveProjectBtn");

    const fieldElements = Array.from(
      document.querySelectorAll("[data-field]")
    );

    // Accordion toggle
    document.querySelectorAll(".accordion-header").forEach(header => {
      header.addEventListener("click", () => {
        const accordion = header.parentElement;
        const isOpen = accordion.classList.contains("open");

        document.querySelectorAll(".accordion").forEach(acc => acc.classList.remove("open"));
        if (!isOpen) accordion.classList.add("open");
      });
    });

    function setStatus(msg, isError = false) {
      statusEl.textContent = msg;
      statusEl.style.color = isError ? "#f97373" : "#a5a5a5";
    }

    function collectFormData() {
      const data = {};
      fieldElements.forEach(el => {
        const key = el.dataset.field;
        if (!key) return;
        if (el.type === "checkbox") {
          data[key] = el.checked ? "1" : "0";
        } else {
          data[key] = el.value || "";
        }
      });
      return data;
    }

    function fillForm(data) {
      fieldElements.forEach(el => {
        const key = el.dataset.field;
        if (!key) return;
        const value = data[key];
        if (value === undefined) return;

        if (el.type === "checkbox") {
          el.checked = value === "1";
        } else {
          el.value = value;
        }
      });
    }

    async function loadProject() {
      const code = projectInput.value.trim();
      if (!code) {
        setStatus("Add meg a project code-ot a bet√∂lt√©shez.", true);
        return;
      }

      setStatus("Loading project‚Ä¶");

      const { data, error } = await supabaseClient
        .from("projects")
        .select("field_name, field_value")
        .eq("client_code", code);

      if (error) {
        console.error(error);
        setStatus("Hiba t√∂rt√©nt bet√∂lt√©s k√∂zben.", true);
        return;
      }

      if (!data || data.length === 0) {
        setStatus("Nincs adat ehhez a project code-hoz (m√©g). √öjk√©nt tudod menteni.");
        // √ºr√≠ts√ºk a formot
        fillForm({});
        return;
      }

      const obj = {};
      data.forEach(row => {
        obj[row.field_name] = row.field_value;
      });

      fillForm(obj);
      setStatus("Project bet√∂ltve: " + code);
    }

    async function saveProject() {
      const code = projectInput.value.trim();
      if (!code) {
        setStatus("Adj egy project code-ot a ment√©shez.", true);
        return;
      }

      const formData = collectFormData();

      setStatus("Saving‚Ä¶");

      // T√∂r√∂lj√ºk a r√©gi sorokat ehhez a project_code-hoz
      const { error: delError } = await supabaseClient
        .from("projects")
        .delete()
        .eq("client_code", code);

      if (delError) {
        console.error(delError);
        setStatus("Hiba t√∂rt√©nt ment√©s (delete) k√∂zben.", true);
        return;
      }

      const rows = Object.entries(formData).map(([field_name, field_value]) => ({
        client_code: code,
        field_name,
        field_value
      }));

      if (rows.length === 0) {
        setStatus("Nincs mentend≈ë adat.");
        return;
      }

      const { error: insError } = await supabaseClient
        .from("projects")
        .insert(rows);

      if (insError) {
        console.error(insError);
        setStatus("Hiba t√∂rt√©nt ment√©s (insert) k√∂zben.", true);
        return;
      }

      setStatus("Mentve: " + code);
    }

    loadBtn.addEventListener("click", loadProject);
    saveBtn.addEventListener("click", saveProject);
  </script>
</body>
</html>

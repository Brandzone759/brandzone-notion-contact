<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Client Contact & Project Infos ‚Äì BrandZone</title>

  <style>
    /* --- Scrollbar elrejt√©se --- */
    html, body {
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    body::-webkit-scrollbar {
      display: none;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #191919;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
      overflow-y: auto;
    }

    .wrapper {
      max-width: 1080px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 22px;
    }

    h2 {
      margin: 0 0 8px 0;
      font-size: 28px;
      font-weight: 700;
      color: #f1f1f1;
    }

    .tagline {
      font-size: 15px;
      color: #b5b5b5;
      margin-top: -6px;
      margin-bottom: 18px;
    }

    /* Project bar */
    .project-bar {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 10px;
      padding: 10px 16px;
      border-radius: 12px;
      background: #232323;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .project-bar-top {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .project-bar-bottom {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .project-bar label {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #bdbdbd;
    }

    .project-bar input[type="text"] {
      flex: 1;
      min-width: 160px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #3c3c3c;
      background: #1f1f1f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .project-bar select {
      min-width: 200px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #3c3c3c;
      background: #1f1f1f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .project-bar button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      background: #3b82f6;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .project-bar button.secondary {
      background: #404040;
    }

    .project-bar button.danger {
      background: #b91c1c;
    }

    .status-text {
      font-size: 12px;
      color: #a5a5a5;
      margin-top: 2px;
    }

    /* Accordion ‚Äì Notion st√≠lus (fels≈ë r√©sz) */
    .accordion {
      border-radius: 16px;
      background: #2B2B2B;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.06);
      transition: 0.15s ease;
    }

    .accordion:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
    }

    .accordion-header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 22px;
      background: #2F2F2F;
      border: none;
      cursor: pointer;
      color: #fafafa;
      font-size: 16px;
      font-weight: 600;
    }

    .accordion-header span.icon {
      font-size: 18px;
      transition: transform 0.2s ease;
    }

    .accordion.open .accordion-header span.icon {
      transform: rotate(90deg);
    }

    .accordion-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.25s ease;
      background: #242424;
      padding: 0 22px;
    }

    .accordion.open .accordion-body {
      padding: 14px 22px 20px 22px;
      max-height: 900px;
    }

    .accordion-body label {
      display: block;
      font-size: 12px;
      letter-spacing: 0.05em;
      margin-top: 12px;
      margin-bottom: 6px;
      color: #bdbdbd;
      text-transform: uppercase;
    }

    .accordion-body input,
    .accordion-body textarea {
      width: 100%;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #3c3c3c;
      background: #1f1f1f;
      color: #f5f5f5;
      font-size: 15px;
      outline: none;
      margin-bottom: 6px;
    }

    .accordion-body textarea {
      resize: vertical;
      min-height: 60px;
    }

    /* Checkbox ‚Äì Notion style */
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      margin-bottom: 6px;
      margin-top: 4px;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: #e5e5e5;
      cursor: pointer;
    }

    .checkbox-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      border: 1px solid #666;
      background: #1f1f1f;
      appearance: none;
      position: relative;
    }

    .checkbox-group input[type="checkbox"]:checked::before {
      content: "";
      position: absolute;
      inset: 2px;
      background: #3b82f6;
      border-radius: 2px;
    }

    .small-note {
      font-size: 12px;
      color: #a5a5a5;
      margin-bottom: 4px;
    }

    /* --- GRID / PROJECT INFOS --- */
    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 16px;
      align-items: start;
      margin-top: 8px;
      margin-bottom: 20px;
    }

    .card {
      background: #2B2B2B;
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s ease;
    }

    .card:hover {
      border-color: rgba(255, 255, 255, 0.15);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .card-header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      background: #2F2F2F;
      border: none;
      cursor: pointer;
      color: #fafafa;
      font-size: 16px;
      font-weight: 600;
      user-select: none;
      text-align: left;
    }

    .card-header .title-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-header .icon {
      font-size: 18px;
    }

    .card-header .arrow {
      font-size: 14px;
      color: #888;
      transition: transform 0.2s ease;
    }

    .card.open .card-header .arrow {
      transform: rotate(180deg);
    }

    .card-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
      background: #252525;
      padding: 0 18px;
    }

    .card.open .card-body {
      padding: 10px 18px 20px 18px;
      max-height: 1000px;
    }

    .card-body label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.03em;
      margin-top: 14px;
      margin-bottom: 6px;
      color: #cfcfcf;
      background: none;
    }

    .card-body label::before {
      content: "üí°";
      font-size: 10px;
      opacity: 0.7;
    }

    .card-body textarea,
    .card-body input {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #3c3c3c;
      background: #1f1f1f;
      color: #f5f5f5;
      font-size: 14px;
      line-height: 1.4;
      outline: none;
    }

    .card-body textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .card-body input {
      margin-bottom: 4px;
    }

    .checkbox-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    @media (max-width: 600px) {
      body {
        padding: 16px;
      }
      .accordion-header {
        padding: 14px 16px;
      }
      .accordion.open .accordion-body {
        padding: 12px 16px 16px 16px;
      }
      .project-bar-top,
      .project-bar-bottom {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- CONTACT + PROJECT BAR -->
    <h2>Client contact ‚Äì BrandZone</h2>
    <p class="tagline">Click the grey boxes to reveal the fields to fill out.</p>

    <div class="project-bar">
      <div class="project-bar-top">
        <label for="projectCode">Project code</label>
        <input id="projectCode" type="text" placeholder="Pl. MINIHOME_2025_Q1" />
        <button id="loadProjectBtn" class="secondary">Load</button>
        <button id="saveProjectBtn">Save</button>
        <button id="deleteProjectBtn" class="danger">Delete</button>
      </div>
      <div class="project-bar-bottom">
        <label for="projectSelector">Saved projects</label>
        <select id="projectSelector">
          <option value="">‚Äì Select saved project ‚Äì</option>
        </select>
      </div>
      <div class="status-text" id="statusText"></div>
    </div>

    <!-- CONTACT PERSON -->
    <div class="accordion">
      <button class="accordion-header">
        üßë Contact person <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Name</label>
        <input type="text" placeholder="Contact person name" data-field="contact_person_name">

        <label>Form of address</label>
        <input type="text" placeholder="casual / polite" data-field="form_of_address">
      </div>
    </div>

    <!-- CONTACT DETAILS -->
    <div class="accordion">
      <button class="accordion-header">
        üìû Contact details <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Phone number</label>
        <input type="text" placeholder="+40 ..." data-field="phone_number">

        <label>E-mail</label>
        <input type="email" placeholder="name@company.com" data-field="email">
      </div>
    </div>

    <!-- WEBSITE & SOCIALS -->
    <div class="accordion">
      <button class="accordion-header">
        üåê Website & Socials <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Website</label>
        <input type="url" placeholder="https://..." data-field="website">

        <label>TikTok</label>
        <input type="url" placeholder="https://www.tiktok.com/@..." data-field="tiktok">

        <label>Facebook</label>
        <input type="url" placeholder="Facebook page link" data-field="facebook">

        <label>Instagram</label>
        <input type="url" placeholder="@brand" data-field="instagram">

        <label>YouTube</label>
        <input type="url" placeholder="Channel link" data-field="youtube">
      </div>
    </div>

    <!-- NEEDS HELP WITH -->
    <div class="accordion">
      <button class="accordion-header">
        üéØ Needs help with <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Problems / pain points</label>
        <textarea placeholder="- Short-form videos, strategy‚Ä¶" data-field="needs_help"></textarea>
      </div>
    </div>

    <!-- PRIMARY COMMUNICATION -->
    <div class="accordion">
      <button class="accordion-header">
        üì¨ Primary communication <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Primary communication</label>
        <div class="checkbox-group">
          <label><input type="checkbox" data-field="primary_email">Email</label>
          <label><input type="checkbox" data-field="primary_whatsapp">WhatsApp</label>
        </div>
      </div>
    </div>

    <!-- POTENTIAL COLLAB -->
    <div class="accordion">
      <button class="accordion-header">
        üìä Potential collab <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Potential collab</label>
        <p class="small-note">How much potential do you see in the collaboration?</p>
        <div class="checkbox-group">
          <label><input type="checkbox" data-field="potential_high">High</label>
          <label><input type="checkbox" data-field="potential_medium">Medium</label>
          <label><input type="checkbox" data-field="potential_low">Low</label>
        </div>
      </div>
    </div>

    <!-- NOTES -->
    <div class="accordion">
      <button class="accordion-header">
        üìù Notes <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Notes</label>
        <textarea placeholder="Any extra info, meeting notes, vibe, important details..." data-field="notes"></textarea>
      </div>
    </div>

    <!-- OVERVIEW: INDUSTRY -->
    <div class="accordion">
      <button class="accordion-header">
        üí° Industry (Services, Products, Prices) <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Industry</label>
        <textarea placeholder="- Services
- Products
- Price range" data-field="industry"></textarea>
      </div>
    </div>

    <!-- OVERVIEW: EMPLOYEES -->
    <div class="accordion">
      <button class="accordion-header">
        üí° Employees <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>Employees</label>
        <textarea placeholder="- Number of employees
- Key roles / departments" data-field="employees"></textarea>
      </div>
    </div>

    <!-- OVERVIEW: WHAT ARE THEY INTERESTED IN -->
    <div class="accordion">
      <button class="accordion-header">
        üí° What are they interested in <span class="icon">‚Ä∫</span>
      </button>
      <div class="accordion-body">
        <label>What are they interested in</label>
        <p class="small-note">Write down the simple need of the lead ‚Äì mit szeretn√©nek el√©rni a social / vide√≥kkal.</p>
        <textarea placeholder="Pl.: more online leads, brand building, employer branding, TikTok presence, etc." data-field="interest"></textarea>
      </div>
    </div>

    <!-- PROJECT INFOS GRID -->
    <h2>Project infos</h2>

    <div class="grid-container">
      <div class="card">
        <button class="card-header">
          <div class="title-group">
            <span class="icon">‚ÑπÔ∏è</span> Basic client information
          </div>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="card-body">
          <label>Short summary of what the company does / Key products</label>
          <textarea placeholder="Summary..." data-field="summary_company"></textarea>

          <label>Target Audience / Buyer Persona</label>
          <textarea placeholder="Who is the target audience?" data-field="target_audience"></textarea>
        </div>
      </div>

      <div class="card">
        <button class="card-header">
          <div class="title-group">
            <span class="icon">üìà</span> Business overview
          </div>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="card-body">
          <label>Existing online presence (socials, website, activity)</label>
          <textarea placeholder="List current channels..." data-field="existing_online_presence"></textarea>

          <label>Competitors mentioned or visible online</label>
          <textarea placeholder="List competitors..." data-field="competitors"></textarea>
        </div>
      </div>

      <div class="card">
        <button class="card-header">
          <div class="title-group">
            <span class="icon">üìä</span> Pain points & challenges
          </div>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="card-body">
          <label>Bullet points note about all of their problems</label>
          <textarea placeholder="- Problem 1&#10;- Problem 2" data-field="pain_points"></textarea>

          <label>Challenges of social media presence / Motivation</label>
          <textarea placeholder="Why do they need help now?" data-field="challenges_motivation"></textarea>
        </div>
      </div>

      <div class="card">
        <button class="card-header">
          <div class="title-group">
            <span class="icon">üìù</span> Customer needs & content
          </div>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="card-body">
          <label>What kind of content the client wants / Story to tell</label>
          <textarea placeholder="Short form, photos, image film..." data-field="content_type"></textarea>

          <label>Tone and style they prefer</label>
          <input type="text" placeholder="Fun, professional, emotional..." data-field="tone_style">

          <label>Frequency / campaign or ongoing idea</label>
          <input type="text" placeholder="e.g. 2 videos / week" data-field="frequency">

          <label>Actor providing</label>
          <input type="text" placeholder="Client provides or Agency?" data-field="actor_providing">

          <label>Social media channels</label>
          <input type="text" placeholder="TikTok, IG, YT..." data-field="social_channels">
        </div>
      </div>

      <div class="card">
        <button class="card-header">
          <div class="title-group">
            <span class="icon">üèÅ</span> The goals
          </div>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="card-body">
          <label>What is the most important result?</label>
          <textarea placeholder="Most important KPI..." data-field="main_result"></textarea>

          <label>Industry or local market?</label>
          <input type="text" placeholder="Local / Global" data-field="industry_or_market">

          <label>Long term or campaign?</label>
          <input type="text" placeholder="Long term / One-off" data-field="long_term_or_campaign">

          <label>What would success look like for them?</label>
          <textarea placeholder="Definition of success..." data-field="success_definition"></textarea>
        </div>
      </div>

      <div class="card">
        <button class="card-header">
          <div class="title-group">
            <span class="icon">üíª</span> Previous experience
          </div>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="card-body">
          <label>Short note of what they liked/disliked about partnerships</label>
          <textarea placeholder="Previous agency experiences..." data-field="previous_experience"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // --- Supabase config ---
    const supabaseUrl = "https://hxtfxjectgauodnzxuqy.supabase.co";
    const supabaseKey = "sb_publishable_Tmc24ujjcIIm3RJ2PKXysA_EI6qPXau";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    const statusEl = document.getElementById("statusText");
    const projectInput = document.getElementById("projectCode");
    const loadBtn = document.getElementById("loadProjectBtn");
    const saveBtn = document.getElementById("saveProjectBtn");
    const deleteBtn = document.getElementById("deleteProjectBtn");
    const projectSelector = document.getElementById("projectSelector");

    const fieldElements = Array.from(
      document.querySelectorAll("[data-field]")
    );

    // Accordion toggle (fels≈ë r√©sz)
    document.querySelectorAll(".accordion-header").forEach(header => {
      header.addEventListener("click", () => {
        const accordion = header.parentElement;
        const isOpen = accordion.classList.contains("open");

        document.querySelectorAll(".accordion").forEach(acc => acc.classList.remove("open"));
        if (!isOpen) accordion.classList.add("open");
      });
    });

    // Card (Project infos) toggle
    document.querySelectorAll(".card-header").forEach(header => {
      header.addEventListener("click", () => {
        const card = header.parentElement;
        card.classList.toggle("open");
      });
    });

    function setStatus(msg, isError = false) {
      statusEl.textContent = msg;
      statusEl.style.color = isError ? "#f97373" : "#a5a5a5";
    }

    function collectFormData() {
      const data = {};
      fieldElements.forEach(el => {
        const key = el.dataset.field;
        if (!key) return;
        if (el.type === "checkbox") {
          data[key] = el.checked ? "1" : "0";
        } else {
          data[key] = el.value || "";
        }
      });
      return data;
    }

    function fillForm(data) {
      fieldElements.forEach(el => {
        const key = el.dataset.field;
        if (!key) return;
        const value = data[key];
        if (value === undefined) {
          if (el.type === "checkbox") el.checked = false;
          else el.value = "";
          return;
        }

        if (el.type === "checkbox") {
          el.checked = value === "1";
        } else {
          el.value = value;
        }
      });
    }

    function clearForm() {
      fillForm({});
    }

    async function loadProject() {
      const code = projectInput.value.trim();
      if (!code) {
        setStatus("Add meg a project code-ot a bet√∂lt√©shez.", true);
        return;
      }

      setStatus("Loading project‚Ä¶");

      const { data, error } = await supabaseClient
        .from("projects")
        .select("field_name, field_value")
        .eq("client_code", code);

      if (error) {
        console.error(error);
        setStatus("Hiba t√∂rt√©nt bet√∂lt√©s k√∂zben.", true);
        return;
      }

      if (!data || data.length === 0) {
        setStatus("Nincs adat ehhez a project code-hoz (m√©g). √öjk√©nt tudod menteni.");
        clearForm();
        return;
      }

      const obj = {};
      data.forEach(row => {
        obj[row.field_name] = row.field_value;
      });

      fillForm(obj);
      setStatus("Project bet√∂ltve: " + code);
    }

    async function saveProject() {
      const code = projectInput.value.trim();
      if (!code) {
        setStatus("Adj egy project code-ot a ment√©shez.", true);
        return;
      }

      const formData = collectFormData();

      setStatus("Saving‚Ä¶");

      const { error: delError } = await supabaseClient
        .from("projects")
        .delete()
        .eq("client_code", code);

      if (delError) {
        console.error(delError);
        setStatus("Hiba t√∂rt√©nt ment√©s (delete) k√∂zben.", true);
        return;
      }

      const rows = Object.entries(formData).map(([field_name, field_value]) => ({
        client_code: code,
        field_name,
        field_value
      }));

      if (rows.length === 0) {
        setStatus("Nincs mentend≈ë adat.");
        return;
      }

      const { error: insError } = await supabaseClient
        .from("projects")
        .insert(rows);

      if (insError) {
        console.error(insError);
        setStatus("Hiba t√∂rt√©nt ment√©s (insert) k√∂zben.", true);
        return;
      }

      setStatus("Mentve: " + code);
      await refreshProjectList(code);
    }

    async function deleteProject() {
      const code = projectInput.value.trim();
      if (!code) {
        setStatus("Nincs project code megadva t√∂rl√©shez.", true);
        return;
      }

      setStatus("Deleting‚Ä¶");

      const { error } = await supabaseClient
        .from("projects")
        .delete()
        .eq("client_code", code);

      if (error) {
        console.error(error);
        setStatus("Hiba t√∂rt√©nt t√∂rl√©s k√∂zben.", true);
        return;
      }

      clearForm();
      projectInput.value = "";
      setStatus("Projekt t√∂r√∂lve: " + code);
      await refreshProjectList();
    }

    async function refreshProjectList(selectCode) {
      const { data, error } = await supabaseClient
        .from("projects")
        .select("client_code")
        .not("client_code", "is", null)
        .order("client_code", { ascending: true });

      if (error) {
        console.error(error);
        setStatus("Nem siker√ºlt bet√∂lteni a saved project list√°t.", true);
        return;
      }

      const uniqueCodes = [...new Set((data || []).map(r => r.client_code))];

      projectSelector.innerHTML = '<option value="">‚Äì Select saved project ‚Äì</option>';
      uniqueCodes.forEach(code => {
        const opt = document.createElement("option");
        opt.value = code;
        opt.textContent = code;
        projectSelector.appendChild(opt);
      });

      if (selectCode && uniqueCodes.includes(selectCode)) {
        projectSelector.value = selectCode;
      } else {
        projectSelector.value = "";
      }
    }

    projectSelector.addEventListener("change", () => {
      const code = projectSelector.value;
      if (!code) return;
      projectInput.value = code;
      loadProject();
    });

    loadBtn.addEventListener("click", loadProject);
    saveBtn.addEventListener("click", saveProject);
    deleteBtn.addEventListener("click", deleteProject);

    // oldal bet√∂lt√©skor friss√≠tj√ºk a saved project list√°t
    refreshProjectList();
  </script>
</body>
</html>
